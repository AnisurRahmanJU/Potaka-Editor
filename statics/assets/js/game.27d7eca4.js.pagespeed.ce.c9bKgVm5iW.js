function gameEndHandler(event,result){var levelMessages=PotakaGame.data.messages||{};if(result.win===!1)var message=levelMessages.fail||":( \u09AC\u09B9\u09C1\u09A4 \u09A6\u09C1\u0995\u09CD\u0995 \u09AA\u09C7\u09B2\u09C1\u09AE \u09B0\u09C7!",btn='<button onclick="PotakaGame.restartGame()">\u0986\u09AC\u09BE\u09B0 \u099A\u09C7\u09B7\u09CD\u099F\u09BE \u0995\u09B0\u09BF</button>';else if(result.level+1<PotakaGame.levels.length){var message=levelMessages.success||"\u09B8\u09BE\u09AC\u09BE\u09B8 !",btn='<button onclick="PotakaGame.restartGame()">\u09AA\u09B0\u09AC\u09B0\u09CD\u09A4\u09C0 \u09B2\u09C7\u09AD\u09C7\u09B2</button>';editor.setValue("")}else{var message="\u09B8\u09AC \u09B2\u09C7\u09AD\u09C7\u09B2 \u0996\u09A4\u09AE !",btn='<button onclick="PotakaGame.loadLevel(0)">\u09B6\u09C1\u09B0\u09C1 \u09A5\u09C7\u0995\u09C7 \u0986\u09AC\u09BE\u09B0</button>';editor.setValue("")}message=result.message||message,setTimeout(function(){PotakaGame.emptyBoard(),$(".gameResultContent").empty(),$(".gameResultContent").append('<h4 class="gameMessage">'+message+"</h4>"),$(".gameResultContent").append(btn),$(".gameResult").fadeIn()},3e3)}!function(t){"use strict";var s=function(s,e){this.el=t(s),this.options=t.extend({},t.fn.typed.defaults,e),this.isInput=this.el.is("input"),this.attr=this.options.attr,this.showCursor=!this.isInput&&this.options.showCursor,this.elContent=this.attr?this.el.attr(this.attr):this.el.text(),this.contentType=this.options.contentType,this.typeSpeed=this.options.typeSpeed,this.startDelay=this.options.startDelay,this.backSpeed=this.options.backSpeed,this.backDelay=this.options.backDelay,this.stringsElement=this.options.stringsElement,this.strings=this.options.strings,this.strPos=0,this.arrayPos=0,this.stopNum=0,this.loop=this.options.loop,this.loopCount=this.options.loopCount,this.curLoop=0,this.stop=!1,this.cursorChar=this.options.cursorChar,this.shuffle=this.options.shuffle,this.sequence=[],this.build()};s.prototype={constructor:s,init:function(){var t=this;t.timeout=setTimeout(function(){for(var s=0;s<t.strings.length;++s)t.sequence[s]=s;t.shuffle&&(t.sequence=t.shuffleArray(t.sequence)),t.typewrite(t.strings[t.sequence[t.arrayPos]],t.strPos)},t.startDelay)},build:function(){var s=this;if(this.showCursor===!0&&(this.cursor=t('<span class="typed-cursor">'+this.cursorChar+"</span>"),this.el.after(this.cursor)),this.stringsElement){this.strings=[],this.stringsElement.hide(),console.log(this.stringsElement.children());var e=this.stringsElement.children();t.each(e,function(e,i){s.strings.push(t(i).html())})}this.init()},typewrite:function(t,s){if(this.stop!==!0){var e=Math.round(70*Math.random())+this.typeSpeed,i=this;i.timeout=setTimeout(function(){var e=0,r=t.substr(s);if("^"===r.charAt(0)){var o=1;/^\^\d+/.test(r)&&(r=/\d+/.exec(r)[0],o+=r.length,e=parseInt(r)),t=t.substring(0,s)+t.substring(s+o)}if("html"===i.contentType){var n=t.substr(s).charAt(0);if("<"===n||"&"===n){var a="",h="";for(h="<"===n?">":";";t.substr(s+1).charAt(0)!==h&&(a+=t.substr(s).charAt(0),s++,!(s+1>t.length)););s++,a+=h}}i.timeout=setTimeout(function(){if(s===t.length){if(i.options.onStringTyped(i.arrayPos),i.arrayPos===i.strings.length-1&&(i.options.callback(),i.curLoop++,i.loop===!1||i.curLoop===i.loopCount))return;i.timeout=setTimeout(function(){i.backspace(t,s)},i.backDelay)}else{0===s&&i.options.preStringTyped(i.arrayPos);var e=t.substr(0,s+1);i.attr?i.el.attr(i.attr,e):i.isInput?i.el.val(e):"html"===i.contentType?i.el.html(e):i.el.text(e),s++,i.typewrite(t,s)}},e)},e)}},backspace:function(t,s){if(this.stop!==!0){var e=Math.round(70*Math.random())+this.backSpeed,i=this;i.timeout=setTimeout(function(){if("html"===i.contentType&&">"===t.substr(s).charAt(0)){for(var e="";"<"!==t.substr(s-1).charAt(0)&&(e-=t.substr(s).charAt(0),s--,!(0>s)););s--,e+="<"}var r=t.substr(0,s);i.attr?i.el.attr(i.attr,r):i.isInput?i.el.val(r):"html"===i.contentType?i.el.html(r):i.el.text(r),s>i.stopNum?(s--,i.backspace(t,s)):s<=i.stopNum&&(i.arrayPos++,i.arrayPos===i.strings.length?(i.arrayPos=0,i.shuffle&&(i.sequence=i.shuffleArray(i.sequence)),i.init()):i.typewrite(i.strings[i.sequence[i.arrayPos]],s))},e)}},shuffleArray:function(t){var s,e,i=t.length;if(i)for(;--i;)e=Math.floor(Math.random()*(i+1)),s=t[e],t[e]=t[i],t[i]=s;return t},reset:function(){var t=this;clearInterval(t.timeout),this.el.attr("id"),this.el.empty(),"undefined"!=typeof this.cursor&&this.cursor.remove(),this.strPos=0,this.arrayPos=0,this.curLoop=0,this.options.resetCallback()}},t.fn.typed=function(e){return this.each(function(){var i=t(this),r=i.data("typed"),o="object"==typeof e&&e;r&&r.reset(),i.data("typed",r=new s(this,o)),"string"==typeof e&&r[e]()})},t.fn.typed.defaults={strings:["These are the default values...","You know what you should do?","Use your own!","Have a great day!"],stringsElement:null,typeSpeed:0,startDelay:0,backSpeed:0,shuffle:!1,backDelay:500,loop:!1,loopCount:!1,showCursor:!0,cursorChar:"|",attr:null,contentType:"html",callback:function(){},preStringTyped:function(){},onStringTyped:function(){},resetCallback:function(){}}}(window.jQuery);var noop=function(){};!function(){for(var boardSize=100,i=1;i<=boardSize;i++)$(".gameContainer").append("<div class='oneBlock' id='box_"+i+"'></div>")}(),$(".gameContainer").on("looseGame",gameEndHandler),$(".gameContainer").on("winGame",gameEndHandler),$("#code").on("runClicked",function(e,data){$(".instructorContainer").hide()}),$("#code").on("codeGenerate",function(e,data){PotakaGame.generatedCode=data}),$(document).ready(function(){PotakaGame.setLevels(["bangladesh.json","bangladesh.loop.json","independence_day.json","aatel.json","fatakesto.json","6.json","7.json"]),PotakaGame.loadLevel(selectedLevel||"bangladesh")});var PotakaGame={playerImg:"/statics/assets/images/ball.gif",levelPath:"/statics/levels/",levels:[],data:null,animQueue:[],currentLevel:0,endGame:!1,isQueueRunning:!1,targetMatched:!1,generatedCode:"",setLevels:function(lvls){this.levels=lvls},goRight:function(){this.animQueue.push({playerAt:this.data.player,step:"right"}),this.data.player=this.data.player+1,this.startQueue(!1)},goLeft:function(){this.animQueue.push({playerAt:this.data.player,step:"left"}),this.data.player=this.data.player-1,this.startQueue(!1)},goUp:function(){this.animQueue.push({playerAt:this.data.player,step:"top"}),this.data.player=this.data.player-10,this.startQueue(!1)},goDown:function(){this.animQueue.push({playerAt:this.data.player,step:"bottom"}),this.data.player=this.data.player+10,this.startQueue(!1)},gameEndAudio:function(){var audioElement=document.createElement("audio");audioElement.setAttribute("src","statics/music/mpthreetest.mp3"),audioElement.setAttribute("autoplay","autoplay"),audioElement.play()},matchData:function(str){return $(".gameHead h2").text()==str},checkRequirements:function(codeData){if(!Array.isArray(this.data.requires))return!0;for(var i=0;i<this.data.requires.length;i++){var maxTimes=this.data.requires[i].max||1,occurance=utils.codeContains(codeData,this.data.requires[i].method);if(0==maxTimes)return!0;if(0==occurance){var errorMessage=this.data.requires[i].error||this.data.requires[i].method+" \u09AC\u09CD\u09AF\u09AC\u09B9\u09BE\u09B0 \u0995\u09B0\u09BE \u09B9\u09DF\u09A8\u09BF\u0964";return utils.gameEnToBn(errorMessage)}if(occurance>maxTimes)return utils.enToBnNumber(maxTimes)+" \u09AC\u09BE\u09B0\u09C7\u09B0 \u09AC\u09C7\u09B6\u09BF "+utils.gameEnToBn(this.data.requires[i].method)+" \u09AC\u09CD\u09AF\u09AC\u09B9\u09BE\u09B0 \u0995\u09B0\u09BE \u09AF\u09BE\u09AC\u09C7 \u09A8\u09BE\u0964"}return!0},emitWin:function(message){var opts={win:!0,level:this.currentLevel,message:message};$(".gameContainer").trigger("winGame",opts),this.currentLevel++},emitLoose:function(message){this.gameEndAudio();var opts={win:!1,level:this.currentLevel,message:message};$(".gameContainer").trigger("looseGame",opts)},emptyBoard:function(){$(".gameResult").hide(),$(".gameContainer > div").empty(),$(".gameContainer > div").removeClass("active"),$(".gameContainer > div > img").remove(),$(".gameHead h2").empty()},isPathAvailable:function(id,step){switch(step){case"right":return $("#box_"+(id+1)).hasClass("active");case"left":return $("#box_"+(id-1)).hasClass("active");case"top":return $("#box_"+(id-10)).hasClass("active");case"bottom":return $("#box_"+(id+10)).hasClass("active")}},restartGame:function(level){this.animQueue=[],this.isQueueRunning=!1,this.endGame=!1,this.targetMatched=!1,this.loadLevel(this.currentLevel)},runCompleted:function(){if(this.endGame===!1&&this.targetMatched===!0){var requirements=this.checkRequirements(this.generatedCode);requirements===!0?this.emitWin():this.emitLoose(requirements)}else this.emitLoose();this.endGame=!0},startQueue:function(isRecursive){if(this.endGame!==!0&&(isRecursive!==!1||this.isQueueRunning!==!0)){if(0==this.animQueue.length)return this.isQueueRunning=!1,this.runCompleted();var level=this.animQueue.shift();if(!level)return this.isQueueRunning=!1,this.runCompleted();if(this.targetMatched===!0)return this.animQueue=[],this.endGame=!0,this.runCompleted();if(this.isPathAvailable(level.playerAt,level.step)===!1)return this.data.player=this.data.player-1,this.endGame=!0,void this.emitLoose();this.isQueueRunning=!0;var move,dataPos;switch(level.step){case"right":move={left:"+=50px"},dataPos=level.playerAt+1;break;case"left":move={left:"-=50px"},dataPos=level.playerAt+1;break;case"top":move={top:"-=50px"},dataPos=level.playerAt-10;break;case"bottom":move={top:"+=50px"},dataPos=level.playerAt+10}var self=this;$(".active.player img").animate(move,function(){var text=$("#box_"+dataPos+" span").text();""!=text&&($(".gameHead h2").append(text),$("#box_"+dataPos+" span").empty(),self.matchData(self.data.word)===!0&&(self.targetMatched=!0)),self.startQueue(!0)})}},loadLevel:function(levelNo,cb){"string"==typeof levelNo&&(levelNo+=".json",levelNo=this.levels.indexOf(levelNo),levelNo===-1&&(levelNo=0)),this.currentLevel=levelNo,this.emptyBoard();var self=this;$.getJSON(this.levelPath+this.levels[levelNo]).done(function(result){self.data=result;var player_pos=$("#box_"+self.data.player);player_pos.addClass("active player").html('<img src="'+self.playerImg+'"/>');var word_data=self.data.data;for(var j in word_data)word_data[j].hasOwnProperty("letter")?$("#"+word_data[j].active).addClass("active").html("<span>"+word_data[j].letter+"</span>"):$("#"+word_data[j].active).addClass("active");self.data.instruction&&($(".gameInstruction").typed({strings:self.data.instruction,typeSpeed:0,loop:!0,showCursor:!1,contentType:"html",callback:function(){}}),$(".instructorContainer").show()),"function"==typeof cb&&cb(result)}).fail(function(jqXHR,textStatus,errorThrown){alert("\u09A6\u09C1:\u0996\u09BF\u09A4\u09C7 \u0997\u09C7\u09AE\u099F\u09BF \u09B2\u09C7\u09BE\u09A1 \u0995\u09B0\u09BE \u09AF\u09BE\u099A\u09CD\u099B\u09C7 \u09A8\u09BE\u0964")})}};